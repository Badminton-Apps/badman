<div *ngIf="this.requests$ | async as request">
  <ng-container *ngIf="this.encounter !== null">
    <form [formGroup]="this.formGroupRequest" novalidate (ngSubmit)="save()">
      <div class="request">
        <h2>
          {{ encounter.home!.name }} {{ 'all.competition.vs' | translate }}
          {{ encounter.away!.name }}
        </h2>

        <div class="dates">
          <h3>
            <div>
              {{ 'all.competition.change-encounter.dates' | translate }}
            </div>
            <div class="caption">
              {{
                'all.competition.change-encounter.disclaimer-submit' | translate
              }}
            </div>
          </h3>

          <div class="date-list" formArrayName="dates">
            <div
              *ngFor="let date of dateControls.controls; let i = index"
              fxLayout="row"
              fxLayoutAlign="start center"
              fxLayoutGap="8px"
              [formGroupName]="i"
              class="date-item"
            >
              <badman-date-selector
                [homeClubId]="encounter.home!.clubId"
                [awayClubId]="encounter.away!.clubId"
                [homeTeamId]="encounter.home!.id"
                [awayTeamId]="encounter.away!.id"
                [home]="this.home"
                formControlName="date"
              ></badman-date-selector>

              <!-- <mat-form-field fxFlex="22">
                <mat-label>{{
                  'all.competition.change-encounter.home' | translate
                }}</mat-label>
                <mat-select formControlName="availabilityHome" required>
                  <mat-option value="POSSIBLE">{{
                    'all.competition.change-encounter.possible' | translate
                  }}</mat-option>
                  <mat-option value="NOT_POSSIBLE">{{
                    'all.competition.change-encounter.not-possible' | translate
                  }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field fxFlex="22">
                <mat-label>{{
                  'all.competition.change-encounter.away' | translate
                }}</mat-label>
                <mat-select formControlName="availabilityAway" required>
                  <mat-option value="POSSIBLE">{{
                    'all.competition.change-encounter.possible' | translate
                  }}</mat-option>
                  <mat-option value="NOT_POSSIBLE">{{
                    'all.competition.change-encounter.not-possible' | translate
                  }}</mat-option>
                </mat-select>
              </mat-form-field> -->

              <mat-checkbox
                class="selected"
                formControlName="selected"
              ></mat-checkbox>

              <div class="delete">
                <div *ngIf="!date.get('id')!.value">
                  <button
                    mat-icon-button
                    (click)="this.removeDate(i)"
                    type="button"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="submit">
          <button mat-stroked-button (click)="this.addDate()" type="button">
            {{ 'all.competition.change-encounter.add-date' | translate }}
          </button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="this.running"
          >
            {{ 'all.button.submit' | translate }}
          </button>
        </div>
      </div>
      <div class="comments">
        <h3>
          {{ 'all.competition.change-encounter.comments' | translate }}
        </h3>

        <div id="body">
          <div
            class="message"
            [ngClass]="{
              me: comment.player?.id === this.authenticateService.user?.id
            }"
            *ngFor="let comment of comments"
          >
            <div class="message-content">
              <label>
                {{ comment.player?.fullName }}
              </label>
              {{ comment.message }}
              <div class="time">
                {{ comment.createdAt | amDateFormat : 'LLL' }}
              </div>
            </div>
          </div>
        </div>

        <div>
          <mat-form-field>
            <mat-label>{{
              'all.competition.change-encounter.comment' | translate
            }}</mat-label>
            <textarea
              matInput
              [formControl]="this.commentControl"
              rows="5"
            ></textarea>
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="send()">
            {{ 'all.button.add-comment' | translate }}
          </button>
        </div>
      </div>
    </form>
  </ng-container>
</div>

<ng-template #confirm>
  <h2 matDialogTitle>
    {{ 'all.competition.change-encounter.submit.title' | translate }}
  </h2>
  <mat-dialog-content>
    <p>
      {{ 'all.competition.change-encounter.submit.description' | translate }}
    </p>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button [matDialogClose]="false">
      {{ 'all.button.no' | translate }}
    </button>
    <button mat-button [matDialogClose]="true" color="primary">
      {{ 'all.button.yes' | translate }}
    </button>
  </mat-dialog-actions>
</ng-template>
