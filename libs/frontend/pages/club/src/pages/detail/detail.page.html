<badman-page-header>
  <div avatar>{{ this.club.abbreviation }}</div>
  <div title>{{this.club.name}}</div>

  <div actions>
    <button mat-icon-button class="favorite" title="favorite">
      <mat-icon>star_outline</mat-icon>
    </button>

    <button mat-icon-button [matMenuTriggerFor]="menu" title="more options">
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #menu="matMenu">
      <badman-has-claim [any]="['edit-any:club', this.club.id + '_edit:club']">
        <button mat-menu-item [routerLink]="['..', this.club.id, 'edit']">
          <mat-icon>edit</mat-icon>
          <span>{{'all.button.edit' | translate}}</span>
        </button>
        <button mat-menu-item (click)="addPlayer()">
          <mat-icon>add</mat-icon>
          <span>{{'all.club.menu.add-player' | translate}}</span>
        </button>
      </badman-has-claim>
      <badman-has-claim [any]="['edit-any:club']">
        <button mat-menu-item>
          <mat-icon>delete</mat-icon>
          <span>{{'all.button.delete' | translate}}</span>
        </button>
      </badman-has-claim>

      <button mat-menu-item (click)="downloadTwizzit()">
        <mat-icon>download</mat-icon>
        <span> {{'all.club.menu.twizzit' | translate}}</span>
      </button>
    </mat-menu>
  </div>
</badman-page-header>

<form [formGroup]="filter" class="filter">
  <mat-button-toggle-group
    name="team types"
    aria-label="team types"
    multiple
    formControlName="choices"
  >
    <mat-button-toggle value="M"
      >{{'all.gender.male' | translate }}</mat-button-toggle
    >
    <mat-button-toggle value="F"
      >{{'all.gender.female' | translate }}</mat-button-toggle
    >
    <mat-button-toggle value="MX"
      >{{'all.gender.mix' | translate }}</mat-button-toggle
    >
    <mat-button-toggle value="NATIONAL"
      >{{'all.gender.national'| translate }}</mat-button-toggle
    >
  </mat-button-toggle-group>

  <!-- year selection -->
  <mat-form-field>
    <mat-label>Season</mat-label>
    <mat-select formControlName="season">
      <mat-option *ngFor="let season of this.seasons" [value]="season">
        {{ season }}
      </mat-option>
    </mat-select>
  </mat-form-field>
</form>

<ng-container *ngIf="this.teams$ | async as teams; else loadingTeams">
  <section class="teams">
    <div class="title">
      <h3>{{'all.club.titles.teams' | translate}}</h3>
      <badman-has-claim [any]="['edit-any:club', this.club.id + '_edit:club']">
        <button mat-icon-button (click)="addTeam()">
          <mat-icon>add</mat-icon>
        </button>
      </badman-has-claim>
    </div>
    <div class="teams-container">
      <div class="team" *ngFor="let team of teams">
        <div [routerLink]="['team',team.slug]">
          <span class="name">{{team.name}}</span>
          <span class="event" *ngIf="team.entry?.subEventCompetition?.name"
            >{{team.entry?.subEventCompetition?.name}}</span
          >
        </div>

        <badman-has-claim
          [any]="['edit-any:club']"
          *ngIf="team.entry?.subEventCompetition?.id"
        >
          <button
            mat-icon-button
            aria-label="edit team"
            class="edit-button"
            (click)="this.editTeam(team)"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </badman-has-claim>

        <!-- allow editing if the entry is empty -->
        <badman-has-claim
          [any]="[this.club.id + '_edit:club']"
          *ngIf="!team.entry?.subEventCompetition?.id"
        >
          <button
            mat-icon-button
            aria-label="edit team"
            class="edit-button"
            (click)="this.editTeam(team)"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </badman-has-claim>
      </div>
    </div>
  </section>

  <section class="games">
    <section class="recent-games">
      <h3>{{"all.game.recent.title" | translate}}</h3>
      <badman-recent-games
        *ngIf="isClient"
        [clubId]="club.id"
        [teams]="teams"
      ></badman-recent-games>
    </section>

    <section class="upcoming-games">
      <h3>{{"all.game.upcoming.title" | translate}}</h3>
      <badman-upcoming-games
        [clubid]="club.id"
        [teams]="teams"
      ></badman-upcoming-games>
    </section>
  </section>
</ng-container>

<ng-container *ngIf="this.players$ | async as players; else loadingPlayers">
  <section class="players">
    <h3>{{'all.club.titles.players' | translate}}</h3>
    <div class="players-container">
      <div class="player" *ngFor="let player of players">
        <div [routerLink]="['/player',player.player.slug]">
          <span class="name">{{player.player.fullName}}</span>
          <span class="playerteams"
            >{{player.teams}} {{'all.team.teams' | translate}}</span
          >
        </div>
        <!-- 
        <badman-has-claim
          [any]="['edit-any:club', this.club.id + '_edit:club']"
        >
          <button
            mat-icon-button
            aria-label="delete player"
            class="edit-button"
            (click)="this.deletePlayer(player.player)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </badman-has-claim> -->
      </div>
    </div>
  </section>
</ng-container>

<ng-template #loadingTeams>
  <section class="teams">
    <h3>{{'all.club.titles.teams' | translate}}</h3>
    <badman-loading-block
      [items]="9"
      height="74px"
      width="250px"
      direction="row"
    />
  </section>

  <section class="games">
    <section class="recent-games">
      <h3>{{"all.game.recent.title" | translate}}</h3>
      <badman-loading-block
        height="24px"
        subHeight="12px"
        [items]="10"
        width="400px"
      />
    </section>
    <section class="upcoming-games">
      <h3>{{"all.game.upcoming.title" | translate}}</h3>
      <badman-loading-block
        height="24px"
        subHeight="12px"
        [items]="10"
        width="300px"
      />
    </section>
  </section>
</ng-template>

<ng-template #loadingPlayers>
  <section class="players">
    <h3>{{'all.club.titles.players' | translate}}</h3>
    <badman-loading-block
      [items]="25"
      height="74px"
      width="250px"
      direction="row"
    />
  </section>
</ng-template>
